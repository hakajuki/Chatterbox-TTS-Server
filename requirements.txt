# ============================================================================
# CHATTERBOX TTS SERVER - REQUIREMENTS (CPU-ONLY INSTALLATION)
# ============================================================================
# This file ensures compatible PyTorch, ML, and audio processing libraries
# are installed for CPU-only operation. All packages are pinned for stability.

# --- PyTorch CPU-Only Installation Index ---
# Use PyTorch's official CPU-only package index for torch components
--extra-index-url https://download.pytorch.org/whl/cpu

# --- Deep Learning Framework (CPU-Only) ---
# Pinning a compatible set of torch-related libraries is crucial to avoid dependency conflicts.
# Updated to use PyTorch 2.5.1 for compatibility with our Colab-compatible chatterbox fork
torch==2.5.1
torchvision==0.20.1
torchaudio==2.5.1

# --- Core TTS Application ---
# Chatterbox TTS engine - Install from chatterbox-v2 fork
chatterbox-tts @ git+https://github.com/devnen/chatterbox-v2.git@master

# --- Web Framework & Server ---
fastapi                         # Modern async web framework
uvicorn[standard]               # ASGI server with performance extras

# --- Scientific Computing & ML Libraries ---
numpy>=1.24.0,<1.26.0           # Fundamental numerical computing
librosa                         # Advanced audio/music analysis
safetensors                     # Safe tensor serialization format
descript-audio-codec            # Audio codec for ML applications

# --- Audio I/O & Processing ---
soundfile                       # Audio file I/O (requires libsndfile system library)
pydub                          # Simple audio manipulation
audiotsm                       # Audio time-scale modification
praat-parselmouth              # Python interface to Praat speech analysis
                               # NOTE: Use 'praat-parselmouth' not 'parselmouth' 
                               # to avoid setuptools use_2to3 compatibility issues

# --- Web & API Utilities ---
python-multipart               # Form data parsing for FastAPI
requests                       # HTTP client library
Jinja2                        # Template engine
aiofiles                      # Async file operations
hf_transfer                     # Speed up file transfers with the Hugging Face Hub.


# --- Configuration & Data Processing ---
PyYAML                        # YAML configuration file support
watchdog                      # File system event monitoring
unidecode                     # Unicode text transliteration
inflect                       # Natural language inflection
tqdm                          # Progress bars for loops

# ============================================================================
# INSTALLATION NOTES:
# 
# 1. Ensure your virtual environment is activated before installation
# 2. Run: pip install --upgrade pip
# 3. Run: pip install -r requirements.txt
# 4. For parselmouth issues, the package name is 'praat-parselmouth' on PyPI
#    but you import it as 'import parselmouth' in Python code
# 5. System dependencies may be required:
#    - libsndfile (for soundfile package)
#    - FFmpeg (for some audio processing features)
# ============================================================================

# ============================================================================
# APPLE SILICON (macOS) / MPS INSTALLATION NOTES
# ============================================================================
# Recommended workflow for Apple Silicon (M1/M2/M3, 2021+ MacBook Pro) when
# you want to use the Metal Performance Shaders (MPS) backend for PyTorch:
# 1) Upgrade pip in your venv:
#
#    python -m pip install --upgrade pip
#
# 2) Install PyTorch with macOS/MPS support using the official PyTorch
#    installer command. Visit https://pytorch.org/get-started/locally/ and
#    select "Mac" + your package manager to obtain the correct command.
#    Example (may change over time):
#
#    pip install torch torchvision torchaudio
#
#    Note: the official PyTorch wheel for macOS includes the MPS backend when
#    run on Apple Silicon. Always prefer the command from the PyTorch web
#    installer to ensure compatibility with your Python version.
#
# 3) After PyTorch is installed, install the remaining Python dependencies
#    listed below (these are the same as the CPU requirements but exclude
#    `torch`, `torchvision`, and `torchaudio` which you installed above):
#
#    pip install -r requirements.txt --no-deps
#
#    Or to install the remaining packages explicitly:
#
#    pip install fastapi uvicorn[standard] numpy librosa safetensors descript-audio-codec \
#        soundfile pydub audiotsm praat-parselmouth python-multipart requests Jinja2 \
#        aiofiles hf_transfer PyYAML watchdog unidecode inflect tqdm
#
# 4) System dependencies: On macOS you may still need `ffmpeg` installed for
#    certain audio operations (recommended via Homebrew: `brew install ffmpeg`).
#
# Troubleshooting:
# - If you encounter import-time errors for `praat-parselmouth`, install
#   system prerequisites or consult the package docs. If `soundfile` fails,
#   install `libsndfile` via Homebrew: `brew install libsndfile`.
# - If you need GPU-accelerated behavior on Apple Silicon, verify MPS
#   availability with: `python -c "import torch; print(torch.backends.mps.is_available())"`
#
# ============================================================================
